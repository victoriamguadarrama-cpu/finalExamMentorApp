<!-- Page Title -->
<div class="page-title" data-aos="fade">
  <div class="heading">
    <div class="container">
      <div class="row d-flex justify-content-center text-center">
        <div class="col-lg-8">
          <h1>Courses</h1>
          <p class="mb-0">
            Explore our diverse range of expert-led training courses designed to
            help you gain valuable skills, enhance your career, and stay ahead
            in your industry. Whether you're looking for professional
            development or personal growth, Mentor has the right course for you.
          </p>
        </div>
      </div>
    </div>
  </div>
  <nav class="breadcrumbs">
    <div class="container">
      <ol>
        <li><a href="/">Home</a></li>
        <li class="current">Courses</li>
      </ol>
    </div>
  </nav>
</div>

<!-- End Page Title -->

<!-- Courses Section -->
<section id="courses" class="courses section">
  <div class="container">
    <div class="row">
      <% courses.forEach((course, index) => { %>
        <div class="col-lg-4 col-md-6 d-flex align-items-stretch" data-aos="zoom-in"
          data-aos-delay="<%= 100 + (index % 3) * 100 %>">
          <div class="course-item">
            <img src="/img/<%= course.image %>" class="img-fluid" alt="<%= course.title %>" />
            <div class="course-content">
              <div class="d-flex justify-content-between align-items-center mb-3">
                <p class="category"><%= course.trainer.expertise %></p>
                <p class="price">$<%= course.price %></p>
              </div>

              <h3>
                <a href="/courses/<%= course.slug %>"><%= course.title %></a>
              </h3>
              <p class="description"><%= course.description %></p>
              
              <div class="trainer d-flex justify-content-between align-items-center">
                <div class="trainer-profile d-flex align-items-center">
                  <img src="/assets/img/trainers/<%= course.trainer.image %>" class="img-fluid" alt="<%= course.trainer.name %>" />
                  <a href="/trainers/<%= course.trainer.slug %>" class="trainer-link">
                    <%= course.trainer.name %>
                  </a>
                </div>
                <div class="trainer-rank d-flex align-items-center">
                  <i class="bi bi-person user-icon"></i>&nbsp;<%= course.registrants.length %>
                  &nbsp;&nbsp;
                  <i class="bi bi-heart heart-icon"></i>&nbsp;<%= course.likes %>
                </div>
              </div>

              <!-- Registration Button Section -->
              <div class="mt-3">
                <p class="mb-2"><small><strong>Available:</strong> <%= course.capacity - course.registrants.length %> / <%= course.capacity %> seats</small></p>
                
                <% if (!isLoggedIn) { %>
                  <a href="/login" class="btn btn-primary btn-sm w-100">Login to Register</a>
                <% } else { %>
                  <% 
                    const userId = user?.id;
                    const isRegistered = course.registrants.some(r => r._id?.toString() === userId);
                    const isFull = course.registrants.length >= course.capacity;
                  %>

                  <% if (isFull && !isRegistered) { %>
                    <button class="btn btn-secondary btn-sm w-100" disabled>Course Full</button>
                  <% } else if (isRegistered) { %>
                    <form action="/courses/unregister/<%= course._id %>" method="POST">
                      <button type="submit" class="btn btn-danger btn-sm w-100">Unregister</button>
                    </form>
                  <% } else { %>
                    <a href="/courses/register/<%= course._id %>" class="btn btn-primary btn-sm w-100">Register</a>
                  <% } %>
                <% } %>
              </div>
              <!-- End Registration Button Section -->

              <!-- Admin Controls -->
              <% if (isAdmin) { %>
                <div class="mt-3">
                  <a href="/admin/edit-course/<%= course._id %>" class="btn btn-warning btn-sm w-100">
                    Edit / Delete Course
                  </a>
                </div>
              <% } %>
              <!-- End Admin Controls -->



            </div>
          </div>
        </div>
      <% }) %>
    </div>
  </div>
</section>
<!-- /Courses Section -->